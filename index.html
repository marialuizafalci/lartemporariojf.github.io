<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abrigo para Pets | SOS Juiz de Fora</title>
  <meta name="description" content="Cadastre ou encontre abrigo temporÃ¡rio para pets desalojados em Juiz de Fora.">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <style>
    :root {
      --primary: #D94B2B;
      --primary-dark: #B03A1E;
      --primary-light: #FEF0EC;
      --amber: #F59E0B;
      --green: #16A34A;
      --green-bg: #F0FDF4;
      --wa: #25D366;
      --wa-dark: #128C7E;
      --bg: #F5F5F5;
      --card: #FFFFFF;
      --text: #1A1A1A;
      --muted: #6B7280;
      --border: #E5E7EB;
      --danger: #DC2626;
      --danger-bg: #FEF2F2;
      --radius: 12px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      font-size: 15px;
      line-height: 1.5;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      background: var(--primary);
      color: white;
      padding: 16px;
      text-align: center;
    }
    .header-back {
      font-size: 13px;
      opacity: 0.8;
      margin-bottom: 6px;
    }
    .header h1 {
      font-size: 21px;
      font-weight: 700;
      letter-spacing: -0.3px;
    }
    .header p {
      font-size: 13px;
      opacity: 0.85;
      margin-top: 4px;
    }

    /* â”€â”€ Alert â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .alert {
      background: #FFFBEB;
      border-left: 4px solid var(--amber);
      padding: 11px 16px;
      font-size: 13px;
      color: #78350F;
    }

    /* â”€â”€ Stats bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats {
      background: white;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
    }
    .stat { text-align: center; }
    .stat-n {
      font-size: 22px;
      font-weight: 700;
      color: var(--primary);
      line-height: 1;
    }
    .stat-l {
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
    }

    /* â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tabs {
      display: flex;
      background: white;
      border-bottom: 2px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 50;
    }
    .tab {
      flex: 1;
      padding: 13px 8px;
      border: none;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      background: none;
      font-size: 14px;
      font-weight: 500;
      color: var(--muted);
      cursor: pointer;
      transition: color 0.15s;
    }
    .tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    /* â”€â”€ Main wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    main {
      max-width: 640px;
      margin: 0 auto;
      padding: 16px;
    }

    /* â”€â”€ Card section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 14px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.07);
    }
    .card-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 7px;
    }

    /* â”€â”€ Form elements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .field { margin-bottom: 15px; }
    .field:last-child { margin-bottom: 0; }

    label.lbl {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 5px;
      color: var(--text);
    }
    label.lbl .req { color: var(--danger); margin-left: 2px; }

    input[type=text], input[type=tel], input[type=date],
    input[type=number], select, textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-size: 15px;
      font-family: inherit;
      background: white;
      color: var(--text);
      transition: border-color 0.15s, box-shadow 0.15s;
      appearance: auto;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(217,75,43,0.12);
    }
    textarea { resize: vertical; }
    .hint { font-size: 12px; color: var(--muted); margin-top: 4px; }

    /* â”€â”€ Pet type grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .pet-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 4px;
    }

    .pet-card {
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 12px 12px 10px;
      cursor: pointer;
      transition: border-color 0.15s, background 0.15s;
      position: relative;
      user-select: none;
    }
    .pet-card:hover { border-color: var(--primary); }
    .pet-card.on {
      border-color: var(--primary);
      background: var(--primary-light);
    }
    .pet-card input[type=checkbox] {
      position: absolute;
      top: 9px; right: 9px;
      width: 17px; height: 17px;
      cursor: pointer;
      accent-color: var(--primary);
    }
    .pet-emoji { font-size: 28px; display: block; margin-bottom: 3px; }
    .pet-name { font-size: 13px; font-weight: 500; }

    .qty-row {
      display: none;
      margin-top: 9px;
      align-items: center;
      gap: 7px;
    }
    .pet-card.on .qty-row { display: flex; }
    .qty-row span { font-size: 12px; color: var(--muted); white-space: nowrap; }
    .qty-row input {
      width: 56px;
      padding: 5px 8px;
      font-size: 14px;
    }

    /* â”€â”€ Chip checkboxes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
    .chip {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 7px 13px;
      border: 2px solid var(--border);
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
    }
    .chip input[type=checkbox] {
      width: 15px; height: 15px;
      accent-color: var(--primary);
    }
    .chip:has(input:checked) {
      border-color: var(--primary);
      background: var(--primary-light);
      color: var(--primary);
    }

    /* â”€â”€ Other pet reveal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .other-reveal { display: none; margin-top: 11px; }

    /* â”€â”€ Dog size (conditional) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #dog-size-section { display: none; }

    /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn-primary {
      width: 100%;
      padding: 15px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-primary:active { transform: scale(0.98); }

    .btn-wa {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 7px;
      width: 100%;
      padding: 12px;
      background: var(--wa);
      color: white;
      border: none;
      border-radius: 9px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.15s;
    }
    .btn-wa:hover { background: var(--wa-dark); }

    .btn-ghost {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--primary);
      color: var(--primary);
      background: white;
      border-radius: 9px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.15s;
    }
    .btn-ghost:hover { background: var(--primary-light); }

    /* â”€â”€ Encerrar abrigo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn-encerrar {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 12px;
      cursor: pointer;
      padding: 4px 0;
      text-decoration: underline;
      margin-top: 6px;
      display: block;
    }
    .btn-encerrar:hover { color: var(--danger); }
    .encerrar-form {
      display: none;
      margin-top: 10px;
      padding: 12px;
      background: #FEF2F2;
      border-radius: 8px;
      border: 1px solid #FECACA;
    }
    .encerrar-form p { font-size: 13px; color: var(--danger); margin-bottom: 8px; }
    .encerrar-form input {
      width: 100%; padding: 8px 10px;
      border: 1.5px solid #FECACA; border-radius: 7px;
      font-size: 14px; margin-bottom: 8px;
    }
    .encerrar-form input:focus { outline: none; border-color: var(--danger); }
    .btn-confirmar-enc {
      width: 100%; padding: 9px;
      background: var(--danger); color: white;
      border: none; border-radius: 7px;
      font-size: 14px; font-weight: 600; cursor: pointer;
    }
    .enc-erro { font-size: 12px; color: var(--danger); margin-top: 6px; display: none; }

    /* â”€â”€ Error / success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .error-box {
      display: none;
      background: var(--danger-bg);
      border-left: 3px solid var(--danger);
      color: var(--danger);
      padding: 10px 13px;
      border-radius: 7px;
      font-size: 14px;
      margin-bottom: 12px;
    }

    .success-box {
      display: none;
      background: var(--green-bg);
      border-radius: var(--radius);
      padding: 28px 20px;
      text-align: center;
    }
    .success-box .ico { font-size: 52px; margin-bottom: 10px; }
    .success-box h2 { font-size: 20px; font-weight: 700; color: var(--green); margin-bottom: 6px; }
    .success-box p { color: #166534; font-size: 14px; margin-bottom: 18px; }

    /* â”€â”€ Find tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .search-box {
      background: white;
      border-radius: var(--radius);
      padding: 14px;
      margin-bottom: 14px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.07);
    }
    .filter-chips { display: flex; gap: 7px; flex-wrap: wrap; margin-top: 10px; }
    .f-chip {
      padding: 6px 12px;
      border: 2px solid var(--border);
      border-radius: 18px;
      background: white;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
      white-space: nowrap;
    }
    .f-chip.on {
      border-color: var(--primary);
      background: var(--primary);
      color: white;
    }

    /* â”€â”€ Shelter cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .shelter-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 15px;
      margin-bottom: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.07);
      border-left: 4px solid var(--green);
    }
    .sc-head {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }
    .sc-name { font-weight: 600; font-size: 16px; }
    .sc-loc { font-size: 12px; color: var(--muted); margin-top: 1px; }
    .badge-avail {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      padding: 3px 8px;
      background: var(--green-bg);
      color: var(--green);
      border-radius: 10px;
      font-size: 11px;
      font-weight: 600;
      white-space: nowrap;
    }
    .pet-tags { display: flex; flex-wrap: wrap; gap: 6px; margin: 9px 0; }
    .pt {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: var(--primary-light);
      color: var(--primary);
      border: 1px solid #F9C5B3;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 500;
    }
    .sc-notes {
      font-size: 13px;
      color: var(--muted);
      font-style: italic;
      margin-bottom: 6px;
    }
    .sc-date { font-size: 11px; color: var(--muted); margin-bottom: 11px; }
    .sc-reqs { font-size: 12px; color: var(--muted); margin-bottom: 8px; }

    /* â”€â”€ Empty / loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .empty {
      text-align: center;
      padding: 48px 20px;
      color: var(--muted);
    }
    .empty .e-ico { font-size: 44px; margin-bottom: 10px; }

    /* â”€â”€ Privacy note â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .privacy { font-size: 12px; color: var(--muted); text-align: center; margin-top: 10px; }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 380px) {
      .pet-grid { grid-template-columns: 1fr; }
      .chips { gap: 6px; }
    }

    .hidden { display: none !important; }

    /* â”€â”€ Sub-tabs buscar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sub-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 14px;
    }
    .sub-tab {
      flex: 1;
      padding: 10px 8px;
      border: 2px solid var(--border);
      border-radius: 9px;
      background: white;
      font-size: 13px;
      font-weight: 500;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.15s;
      text-align: center;
    }
    .sub-tab.active {
      border-color: var(--primary);
      background: var(--primary-light);
      color: var(--primary);
    }

    /* â”€â”€ Request cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .request-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 15px;
      margin-bottom: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.07);
      border-left: 4px solid var(--amber);
    }
    .badge-request {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      padding: 3px 8px;
      background: #FFFBEB;
      color: #92400E;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 600;
      white-space: nowrap;
    }
  </style>
</head>
<body>

<!-- â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header class="header">
  <div class="header-back">ğŸ†˜ SOS Juiz de Fora</div>
  <h1>ğŸ¾ Abrigo TemporÃ¡rio para Pets</h1>
  <p>Conectando animais desalojados com famÃ­lias acolhedoras</p>
</header>

<!-- â”€â”€ Alert banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="alert">
  âš ï¸ <strong>EmergÃªncia ativa em JF.</strong> Mais de 3.500 desabrigados e 50 vidas perdidas. Cada abrigo conta.
</div>

<!-- â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="stats">
  <div class="stat">
    <div class="stat-n" id="sn-total">â€”</div>
    <div class="stat-l">Abrigos<br>cadastrados</div>
  </div>
  <div class="stat">
    <div class="stat-n" id="sn-dogs">â€”</div>
    <div class="stat-l">Vagas<br>p/ cÃ£es</div>
  </div>
  <div class="stat">
    <div class="stat-n" id="sn-cats">â€”</div>
    <div class="stat-l">Vagas<br>p/ gatos</div>
  </div>
  <div class="stat">
    <div class="stat-n" id="sn-other">â€”</div>
    <div class="stat-l">Vagas<br>outros</div>
  </div>
</div>

<!-- â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="tabs">
  <button class="tab active" id="tab-offer" onclick="switchTab('offer')">ğŸ  Oferecer</button>
  <button class="tab" id="tab-request" onclick="switchTab('request')">ğŸ†˜ Preciso</button>
  <button class="tab" id="tab-find" onclick="switchTab('find')">ğŸ” Buscar</button>
</div>

<main>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB: OFERECER ABRIGO
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-offer">

    <div id="form-wrap">

      <!-- Dados pessoais -->
      <div class="card">
        <div class="card-title">ğŸ‘¤ Seus dados de contato</div>

        <div class="field">
          <label class="lbl" for="f-name">Nome completo <span class="req">*</span></label>
          <input type="text" id="f-name" placeholder="Como podemos te chamar?" maxlength="80" autocomplete="name">
        </div>

        <div class="field">
          <label class="lbl" for="f-phone">WhatsApp <span class="req">*</span></label>
          <input type="tel" id="f-phone" placeholder="(32) 99999-9999" maxlength="20" autocomplete="tel">
          <div class="hint">Tutores entrarÃ£o em contato por WhatsApp</div>
        </div>
      </div>

      <!-- LocalizaÃ§Ã£o -->
      <div class="card">
        <div class="card-title">ğŸ“ LocalizaÃ§Ã£o</div>

        <div class="field">
          <label class="lbl" for="f-bairro">Bairro <span class="req">*</span></label>
          <select id="f-bairro">
            <option value="">Selecione o bairro...</option>
            <option>Alto dos Passos</option>
            <option>Bandeirantes</option>
            <option>Benfica</option>
            <option>Borboleta</option>
            <option>Cascatinha</option>
            <option>Centro</option>
            <option>CerÃ¢mica</option>
            <option>Cruzeiro do Sul</option>
            <option>FÃ¡tima</option>
            <option>Graminha</option>
            <option>Granbery</option>
            <option>Igrejinha</option>
            <option>Industrial</option>
            <option>Ipiranga</option>
            <option>Jardim Natal</option>
            <option>Linhares</option>
            <option>Manoel HonÃ³rio</option>
            <option>Mariano ProcÃ³pio</option>
            <option>Monte Castelo</option>
            <option>Nova Era</option>
            <option>Paineiras</option>
            <option>Ramos</option>
            <option>Santa CÃ¢ndida</option>
            <option>Santa Helena</option>
            <option>Santa Luzia</option>
            <option>Santa Rita</option>
            <option>Santo AntÃ´nio</option>
            <option>SÃ£o Judas Tadeu</option>
            <option>SÃ£o Mateus</option>
            <option>SÃ£o Pedro</option>
            <option>Teixeiras</option>
            <option>Vitorino Braga</option>
            <option>Outro</option>
          </select>
        </div>

        <div class="field">
          <label class="lbl" for="f-ref">ReferÃªncia (opcional)</label>
          <input type="text" id="f-ref" placeholder="Ex: perto da escola X, prÃ³ximo Ã  praÃ§a Y...">
          <div class="hint">NÃ£o compartilhe seu endereÃ§o completo por seguranÃ§a</div>
        </div>
      </div>

      <!-- Tipos de animais -->
      <div class="card">
        <div class="card-title">ğŸ¾ Quais animais vocÃª pode abrigar?</div>
        <div class="hint" style="margin-bottom: 13px;">Selecione um ou mais tipos e informe quantas vagas vocÃª tem para cada um</div>

        <div class="pet-grid">

          <div class="pet-card" id="pc-dogs" onclick="togglePet('dogs',event)">
            <input type="checkbox" id="cb-dogs" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ¶</span>
            <span class="pet-name">CÃ£es</span>
            <div class="qty-row">
              <span>Vagas:</span>
              <input type="number" id="qty-dogs" min="1" max="30" value="1" onclick="event.stopPropagation()">
            </div>
          </div>

          <div class="pet-card" id="pc-cats" onclick="togglePet('cats',event)">
            <input type="checkbox" id="cb-cats" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ±</span>
            <span class="pet-name">Gatos</span>
            <div class="qty-row">
              <span>Vagas:</span>
              <input type="number" id="qty-cats" min="1" max="30" value="1" onclick="event.stopPropagation()">
            </div>
          </div>

          <div class="pet-card" id="pc-birds" onclick="togglePet('birds',event)">
            <input type="checkbox" id="cb-birds" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ¦</span>
            <span class="pet-name">PÃ¡ssaros / Aves</span>
            <div class="qty-row">
              <span>Vagas:</span>
              <input type="number" id="qty-birds" min="1" max="30" value="1" onclick="event.stopPropagation()">
            </div>
          </div>

          <div class="pet-card" id="pc-rabbits" onclick="togglePet('rabbits',event)">
            <input type="checkbox" id="cb-rabbits" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ°</span>
            <span class="pet-name">Coelhos</span>
            <div class="qty-row">
              <span>Vagas:</span>
              <input type="number" id="qty-rabbits" min="1" max="30" value="1" onclick="event.stopPropagation()">
            </div>
          </div>

          <div class="pet-card" id="pc-reptiles" onclick="togglePet('reptiles',event)">
            <input type="checkbox" id="cb-reptiles" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ¦</span>
            <span class="pet-name">RÃ©pteis</span>
            <div class="qty-row">
              <span>Vagas:</span>
              <input type="number" id="qty-reptiles" min="1" max="30" value="1" onclick="event.stopPropagation()">
            </div>
          </div>

          <div class="pet-card" id="pc-others" onclick="togglePet('others',event)">
            <input type="checkbox" id="cb-others" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ¹</span>
            <span class="pet-name">Outros animais</span>
            <div class="qty-row">
              <span>Vagas:</span>
              <input type="number" id="qty-others" min="1" max="30" value="1" onclick="event.stopPropagation()">
            </div>
          </div>

        </div>

        <!-- Campo "outros" condicional -->
        <div class="other-reveal" id="other-reveal">
          <label class="lbl" for="f-other-type">Que tipo de animal? <span class="req">*</span></label>
          <input type="text" id="f-other-type" placeholder="Ex: hamster, tartaruga, porquinho-da-Ã­ndia...">
        </div>
      </div>

      <!-- Porte dos cÃ£es (condicional) -->
      <div class="card" id="dog-size-section">
        <div class="card-title">ğŸ“ Porte dos cÃ£es aceitos</div>
        <div class="chips">
          <label class="chip">
            <input type="checkbox" name="dog-size" value="small" checked>
            ğŸ• Pequeno (atÃ© 10kg)
          </label>
          <label class="chip">
            <input type="checkbox" name="dog-size" value="medium">
            ğŸ• MÃ©dio (10â€“25kg)
          </label>
          <label class="chip">
            <input type="checkbox" name="dog-size" value="large">
            ğŸ• Grande (acima de 25kg)
          </label>
        </div>
      </div>

      <!-- CondiÃ§Ãµes -->
      <div class="card">
        <div class="card-title">ğŸ“‹ CondiÃ§Ãµes e observaÃ§Ãµes</div>

        <div class="field">
          <label class="lbl">O animal precisa ser/estar (opcional)</label>
          <div class="chips">
            <label class="chip">
              <input type="checkbox" name="cond" value="vaccinated">
              ğŸ’‰ Vacinado
            </label>
            <label class="chip">
              <input type="checkbox" name="cond" value="castrated">
              âœ‚ï¸ Castrado
            </label>
            <label class="chip">
              <input type="checkbox" name="cond" value="owner-present">
              ğŸ‘¤ Tutor fica junto
            </label>
          </div>
        </div>

        <div class="field">
          <label class="lbl" for="f-notes">ObservaÃ§Ãµes adicionais</label>
          <textarea id="f-notes" rows="3" placeholder="Ex: tenho um cÃ£o adulto na casa, quintal murado, moro em apartamento, sem crianÃ§as..."></textarea>
        </div>
      </div>

      <!-- Disponibilidade -->
      <div class="card">
        <div class="card-title">ğŸ“… Disponibilidade</div>

        <div class="field">
          <label class="lbl" for="f-from">DisponÃ­vel a partir de <span class="req">*</span></label>
          <input type="date" id="f-from">
        </div>

        <div class="field">
          <label class="lbl" for="f-until">DisponÃ­vel atÃ© (estimado)</label>
          <input type="date" id="f-until">
          <div class="hint">Deixe em branco se for indefinido. Pode ser atualizado a qualquer momento.</div>
        </div>
      </div>

      <!-- Erro -->
      <div class="error-box" id="error-box"></div>

      <!-- Submit -->
      <button class="btn-primary" onclick="submitForm()">
        ğŸ¾ Cadastrar meu abrigo
      </button>
      <p class="privacy">Seus dados serÃ£o usados exclusivamente para conectar tutores que precisam de ajuda com vocÃª.</p>
    </div>

    <!-- Estado de sucesso -->
    <div class="success-box" id="success-box">
      <div class="ico">âœ…</div>
      <h2>Abrigo cadastrado!</h2>
      <p>
        Obrigado, <strong id="success-name"></strong>!<br>
        Seu cadastro jÃ¡ estÃ¡ visÃ­vel para tutores em busca de abrigo.
        Compartilhe para ajudar mais famÃ­lias:
      </p>
      <a class="btn-wa" id="wa-share-btn" href="#" target="_blank">
        ğŸ“² Compartilhar no WhatsApp
      </a>
      <button class="btn-ghost" onclick="resetForm()">+ Cadastrar outro abrigo</button>
    </div>

  </div><!-- /view-offer -->


  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB: PRECISO DE ABRIGO
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-request" class="hidden">

    <div id="req-form-wrap">

      <div class="card">
        <div class="card-title">ğŸ‘¤ Seus dados de contato</div>
        <div class="field">
          <label class="lbl" for="r-name">Nome completo <span class="req">*</span></label>
          <input type="text" id="r-name" placeholder="Como podemos te chamar?" maxlength="80" autocomplete="name">
        </div>
        <div class="field">
          <label class="lbl" for="r-phone">WhatsApp <span class="req">*</span></label>
          <input type="tel" id="r-phone" placeholder="(32) 99999-9999" maxlength="20" autocomplete="tel">
          <div class="hint">Quem puder ajudar entrarÃ¡ em contato por WhatsApp</div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">ğŸ“ LocalizaÃ§Ã£o atual</div>
        <div class="field">
          <label class="lbl" for="r-bairro">Bairro <span class="req">*</span></label>
          <select id="r-bairro">
            <option value="">Selecione o bairro...</option>
            <option>Alto dos Passos</option><option>Bandeirantes</option>
            <option>Benfica</option><option>Borboleta</option>
            <option>Cascatinha</option><option>Centro</option>
            <option>CerÃ¢mica</option><option>Cruzeiro do Sul</option>
            <option>FÃ¡tima</option><option>Graminha</option>
            <option>Granbery</option><option>Igrejinha</option>
            <option>Industrial</option><option>Ipiranga</option>
            <option>Jardim Natal</option><option>Linhares</option>
            <option>Manoel HonÃ³rio</option><option>Mariano ProcÃ³pio</option>
            <option>Monte Castelo</option><option>Nova Era</option>
            <option>Paineiras</option><option>Ramos</option>
            <option>Santa CÃ¢ndida</option><option>Santa Helena</option>
            <option>Santa Luzia</option><option>Santa Rita</option>
            <option>Santo AntÃ´nio</option><option>SÃ£o Judas Tadeu</option>
            <option>SÃ£o Mateus</option><option>SÃ£o Pedro</option>
            <option>Teixeiras</option><option>Vitorino Braga</option>
            <option>Outro</option>
          </select>
        </div>
      </div>

      <div class="card">
        <div class="card-title">ğŸ¾ Quais animais precisam de abrigo?</div>
        <div class="hint" style="margin-bottom:13px">Selecione os tipos e informe a quantidade de cada um</div>

        <div class="pet-grid">
          <div class="pet-card" id="rpc-dogs" onclick="toggleReqPet('dogs',event)">
            <input type="checkbox" id="rcb-dogs" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ¶</span><span class="pet-name">CÃ£es</span>
            <div class="qty-row"><span>Qtd:</span>
              <input type="number" id="rqty-dogs" min="1" max="20" value="1" onclick="event.stopPropagation()">
            </div>
          </div>
          <div class="pet-card" id="rpc-cats" onclick="toggleReqPet('cats',event)">
            <input type="checkbox" id="rcb-cats" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ±</span><span class="pet-name">Gatos</span>
            <div class="qty-row"><span>Qtd:</span>
              <input type="number" id="rqty-cats" min="1" max="20" value="1" onclick="event.stopPropagation()">
            </div>
          </div>
          <div class="pet-card" id="rpc-birds" onclick="toggleReqPet('birds',event)">
            <input type="checkbox" id="rcb-birds" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ¦</span><span class="pet-name">PÃ¡ssaros / Aves</span>
            <div class="qty-row"><span>Qtd:</span>
              <input type="number" id="rqty-birds" min="1" max="20" value="1" onclick="event.stopPropagation()">
            </div>
          </div>
          <div class="pet-card" id="rpc-rabbits" onclick="toggleReqPet('rabbits',event)">
            <input type="checkbox" id="rcb-rabbits" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ°</span><span class="pet-name">Coelhos</span>
            <div class="qty-row"><span>Qtd:</span>
              <input type="number" id="rqty-rabbits" min="1" max="20" value="1" onclick="event.stopPropagation()">
            </div>
          </div>
          <div class="pet-card" id="rpc-reptiles" onclick="toggleReqPet('reptiles',event)">
            <input type="checkbox" id="rcb-reptiles" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ¦</span><span class="pet-name">RÃ©pteis</span>
            <div class="qty-row"><span>Qtd:</span>
              <input type="number" id="rqty-reptiles" min="1" max="20" value="1" onclick="event.stopPropagation()">
            </div>
          </div>
          <div class="pet-card" id="rpc-others" onclick="toggleReqPet('others',event)">
            <input type="checkbox" id="rcb-others" onclick="event.stopPropagation()">
            <span class="pet-emoji">ğŸ¹</span><span class="pet-name">Outros animais</span>
            <div class="qty-row"><span>Qtd:</span>
              <input type="number" id="rqty-others" min="1" max="20" value="1" onclick="event.stopPropagation()">
            </div>
          </div>
        </div>

        <div class="other-reveal" id="r-other-reveal">
          <label class="lbl" for="r-other-type">Que tipo de animal? <span class="req">*</span></label>
          <input type="text" id="r-other-type" placeholder="Ex: hamster, tartaruga...">
        </div>
      </div>

      <div class="card">
        <div class="card-title">ğŸ“‹ ObservaÃ§Ãµes</div>
        <div class="field">
          <label class="lbl" for="r-notes">InformaÃ§Ãµes importantes sobre o animal</label>
          <textarea id="r-notes" rows="3" placeholder="Ex: cÃ£o idoso, gato com medicaÃ§Ã£o diÃ¡ria, animal assustado, nÃ£o pode ficar com outros animais..."></textarea>
        </div>
        <div class="field">
          <label class="lbl" for="r-until">Precisa de abrigo atÃ©</label>
          <input type="date" id="r-until">
          <div class="hint">Deixe em branco se nÃ£o souber.</div>
        </div>
      </div>

      <div class="error-box" id="r-error-box"></div>

      <button class="btn-primary" onclick="submitRequest()">
        ğŸ†˜ Cadastrar pedido de abrigo
      </button>
      <p class="privacy">Seus dados serÃ£o usados apenas para conectar vocÃª com quem pode ajudar.</p>
    </div>

    <div class="success-box" id="req-success-box">
      <div class="ico">âœ…</div>
      <h2>Pedido cadastrado!</h2>
      <p>
        Obrigado, <strong id="req-success-name"></strong>!<br>
        Seu pedido estÃ¡ visÃ­vel para quem oferece abrigo.
        Compartilhe para aumentar as chances:
      </p>
      <a class="btn-wa" id="req-wa-share" href="#" target="_blank">
        ğŸ“² Compartilhar no WhatsApp
      </a>
      <button class="btn-ghost" onclick="resetRequest()">+ Cadastrar outro pedido</button>
    </div>

  </div><!-- /view-request -->


  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB: BUSCAR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-find" class="hidden">

    <div class="sub-tabs">
      <button class="sub-tab active" id="sub-shelters" onclick="switchSubTab('shelters')">ğŸ  Abrigos disponÃ­veis</button>
      <button class="sub-tab" id="sub-requests" onclick="switchSubTab('requests')">ğŸ†˜ Pedidos de abrigo</button>
    </div>

    <div class="search-box">
      <input type="text" id="search-input" placeholder="ğŸ” Buscar por bairro ou nome..." oninput="onSearch()">
      <div class="filter-chips" id="filter-chips">
        <button class="f-chip on" onclick="setFilter('all',this)">Todos</button>
        <button class="f-chip" onclick="setFilter('dogs',this)">ğŸ¶ CÃ£es</button>
        <button class="f-chip" onclick="setFilter('cats',this)">ğŸ± Gatos</button>
        <button class="f-chip" onclick="setFilter('birds',this)">ğŸ¦ Aves</button>
        <button class="f-chip" onclick="setFilter('rabbits',this)">ğŸ° Coelhos</button>
        <button class="f-chip" onclick="setFilter('reptiles',this)">ğŸ¦ RÃ©pteis</button>
        <button class="f-chip" onclick="setFilter('others',this)">ğŸ¹ Outros</button>
      </div>
    </div>

    <div id="shelters-list"></div>

  </div><!-- /view-find -->

</main>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUPABASE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const { createClient } = window.supabase;
const db = createClient(
  'https://vqmoyfykxccgbdknocpp.supabase.co',
  'sb_publishable_FiwU4AucQkViFZHljphUrA_6v76lEPy'
);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function switchTab(t) {
  ['offer','request','find'].forEach(id => {
    document.getElementById('view-' + id).classList.toggle('hidden', t !== id);
    document.getElementById('tab-' + id).classList.toggle('active', t === id);
  });
  if (t === 'find') renderCurrent();
}

let activeSubTab = 'shelters';
function switchSubTab(st) {
  activeSubTab = st;
  document.getElementById('sub-shelters').classList.toggle('active', st === 'shelters');
  document.getElementById('sub-requests').classList.toggle('active', st === 'requests');
  // reset filter
  document.querySelectorAll('.f-chip').forEach((el,i) => el.classList.toggle('on', i === 0));
  activeFilter = 'all';
  renderCurrent();
}

function onSearch() { renderCurrent(); }
function renderCurrent() {
  if (activeSubTab === 'shelters') renderShelters();
  else renderRequests();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PET TYPE TOGGLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PET_TYPES = ['dogs','cats','birds','rabbits','reptiles','others'];

function togglePet(type, e) {
  // Don't toggle if user clicked number input
  if (e && e.target.type === 'number') return;

  const cb = document.getElementById('cb-' + type);
  // If the actual checkbox was clicked, its state is already toggled
  if (e && e.target !== cb) cb.checked = !cb.checked;

  const card = document.getElementById('pc-' + type);
  card.classList.toggle('on', cb.checked);

  if (type === 'dogs') {
    document.getElementById('dog-size-section').style.display = cb.checked ? 'block' : 'none';
  }
  if (type === 'others') {
    document.getElementById('other-reveal').style.display = cb.checked ? 'block' : 'none';
  }
}

function toggleReqPet(type, e) {
  if (e && e.target.type === 'number') return;
  const cb = document.getElementById('rcb-' + type);
  if (e && e.target !== cb) cb.checked = !cb.checked;
  document.getElementById('rpc-' + type).classList.toggle('on', cb.checked);
  if (type === 'others') document.getElementById('r-other-reveal').style.display = cb.checked ? 'block' : 'none';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM SUBMIT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function submitForm() {
  const err = document.getElementById('error-box');
  err.style.display = 'none';

  const name   = document.getElementById('f-name').value.trim();
  const phone  = document.getElementById('f-phone').value.trim();
  const bairro = document.getElementById('f-bairro').value;
  const from   = document.getElementById('f-from').value;

  const pets = {};
  PET_TYPES.forEach(t => {
    if (document.getElementById('cb-' + t).checked)
      pets[t] = parseInt(document.getElementById('qty-' + t).value) || 1;
  });

  if (!name)                      return showErr(err, 'Informe seu nome completo.');
  if (!phone || phone.replace(/\D/g,'').length < 10)
                                  return showErr(err, 'Informe um WhatsApp vÃ¡lido com DDD (ex: 32 99999-9999).');
  if (!bairro)                    return showErr(err, 'Selecione o bairro.');
  if (!Object.keys(pets).length)  return showErr(err, 'Selecione ao menos um tipo de animal.');
  if (!from)                      return showErr(err, 'Informe a data de disponibilidade.');
  if (pets.others && !document.getElementById('f-other-type').value.trim())
                                  return showErr(err, 'Informe que tipo de animal vocÃª aceita em "Outros animais".');

  const dogSizes = pets.dogs
    ? [...document.querySelectorAll('input[name="dog-size"]:checked')].map(el => el.value)
    : [];
  const conds = [...document.querySelectorAll('input[name="cond"]:checked')].map(el => el.value);

  const btn = document.querySelector('.btn-primary');
  btn.disabled = true;
  btn.textContent = 'Salvando...';

  const { error } = await db.from('pet_shelters').insert({
    name, phone, bairro,
    address_ref:     document.getElementById('f-ref').value.trim(),
    pets,
    dog_sizes:       dogSizes,
    conds,
    notes:           document.getElementById('f-notes').value.trim(),
    available_from:  from,
    available_until: document.getElementById('f-until').value || null,
    other_type:      document.getElementById('f-other-type').value.trim(),
  });

  btn.disabled = false;
  btn.innerHTML = 'ğŸ¾ Cadastrar meu abrigo';

  if (error) return showErr(err, 'Erro ao salvar. Tente novamente. (' + error.message + ')');

  showSuccess(name);
  updateStats();
}

function showErr(el, msg) {
  el.textContent = 'âš ï¸ ' + msg;
  el.style.display = 'block';
  el.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function showSuccess(name) {
  document.getElementById('form-wrap').classList.add('hidden');
  const box = document.getElementById('success-box');
  box.style.display = 'block';
  document.getElementById('success-name').textContent = name.split(' ')[0];
  const msg = encodeURIComponent('ğŸ¾ Me cadastrei para oferecer abrigo temporÃ¡rio para pets no SOS Juiz de Fora! Se vocÃª precisa de um lar temporÃ¡rio para seu animal, acesse: https://sosjuizdefora.com.br');
  document.getElementById('wa-share-btn').href = 'https://wa.me/?text=' + msg;
}

function resetForm() {
  document.getElementById('success-box').style.display = 'none';
  document.getElementById('form-wrap').classList.remove('hidden');

  // Reset inputs
  ['f-name','f-phone','f-bairro','f-ref','f-notes','f-until','f-other-type']
    .forEach(id => { const el = document.getElementById(id); if (el) el.value = el.tagName === 'SELECT' ? '' : ''; });
  document.getElementById('f-from').value = today();

  // Reset pet cards
  PET_TYPES.forEach(t => {
    document.getElementById('cb-' + t).checked = false;
    document.getElementById('pc-' + t).classList.remove('on');
  });
  document.getElementById('dog-size-section').style.display = 'none';
  document.getElementById('other-reveal').style.display = 'none';
  document.getElementById('error-box').style.display = 'none';

  // Reset size/cond checkboxes
  document.querySelectorAll('input[name="dog-size"]').forEach((el,i) => el.checked = i === 0);
  document.querySelectorAll('input[name="cond"]').forEach(el => el.checked = false);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PEDIDO DE ABRIGO
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function submitRequest() {
  const err = document.getElementById('r-error-box');
  err.style.display = 'none';

  const name   = document.getElementById('r-name').value.trim();
  const phone  = document.getElementById('r-phone').value.trim();
  const bairro = document.getElementById('r-bairro').value;

  const pets = {};
  PET_TYPES.forEach(t => {
    if (document.getElementById('rcb-' + t).checked)
      pets[t] = parseInt(document.getElementById('rqty-' + t).value) || 1;
  });

  if (!name)                     return showErr(err, 'Informe seu nome completo.');
  if (!phone || phone.replace(/\D/g,'').length < 10)
                                 return showErr(err, 'Informe um WhatsApp vÃ¡lido com DDD.');
  if (!bairro)                   return showErr(err, 'Selecione o bairro.');
  if (!Object.keys(pets).length) return showErr(err, 'Selecione ao menos um tipo de animal.');
  if (pets.others && !document.getElementById('r-other-type').value.trim())
                                 return showErr(err, 'Informe que tipo de animal em "Outros animais".');

  const btn = document.querySelector('#req-form-wrap .btn-primary');
  btn.disabled = true;
  btn.textContent = 'Salvando...';

  const { error } = await db.from('pet_requests').insert({
    name, phone, bairro,
    pets,
    notes:        document.getElementById('r-notes').value.trim(),
    needed_until: document.getElementById('r-until').value || null,
    other_type:   document.getElementById('r-other-type').value.trim(),
  });

  btn.disabled = false;
  btn.innerHTML = 'ğŸ†˜ Cadastrar pedido de abrigo';

  if (error) return showErr(err, 'Erro ao salvar. Tente novamente. (' + error.message + ')');

  document.getElementById('req-form-wrap').classList.add('hidden');
  document.getElementById('req-success-box').style.display = 'block';
  document.getElementById('req-success-name').textContent = name.split(' ')[0];
  const msg = encodeURIComponent('ğŸ†˜ Preciso de abrigo temporÃ¡rio para meu pet em JF! Se puder ajudar, acesse: https://sosjuizdefora.com.br');
  document.getElementById('req-wa-share').href = 'https://wa.me/?text=' + msg;
}

function resetRequest() {
  document.getElementById('req-success-box').style.display = 'none';
  document.getElementById('req-form-wrap').classList.remove('hidden');
  ['r-name','r-phone','r-notes','r-until','r-other-type']
    .forEach(id => { const el = document.getElementById(id); if (el) el.value = ''; });
  document.getElementById('r-bairro').value = '';
  PET_TYPES.forEach(t => {
    document.getElementById('rcb-' + t).checked = false;
    document.getElementById('rpc-' + t).classList.remove('on');
  });
  document.getElementById('r-other-reveal').style.display = 'none';
  document.getElementById('r-error-box').style.display = 'none';
}

async function renderRequests() {
  const list = document.getElementById('shelters-list');
  list.innerHTML = '<div class="empty"><div class="e-ico">â³</div>Carregando...</div>';

  const { data, error } = await db
    .from('pet_requests')
    .select('*')
    .order('created_at', { ascending: false });

  if (error) {
    list.innerHTML = '<div class="empty">Erro ao carregar. Tente novamente.</div>';
    return;
  }

  const q = document.getElementById('search-input').value.toLowerCase().trim();
  let requests = data || [];
  if (activeFilter !== 'all') requests = requests.filter(r => r.pets && r.pets[activeFilter]);
  if (q) requests = requests.filter(r =>
    r.bairro.toLowerCase().includes(q) || r.name.toLowerCase().includes(q)
  );

  if (!requests.length) {
    list.innerHTML = `
      <div class="empty">
        <div class="e-ico">ğŸ¾</div>
        <strong>Nenhum pedido encontrado</strong>
        <div style="font-size:13px;margin-top:8px">Nenhum tutor pedindo abrigo no momento.</div>
      </div>`;
    return;
  }

  list.innerHTML = requests.map(r => {
    const ptags = Object.entries(r.pets || {}).map(([t, qty]) => {
      const m = PET_META[t] || { emoji:'ğŸ¾', label: t };
      const extra = (t === 'others' || t === 'reptiles') && r.other_type ? ` â€“ ${esc(r.other_type)}` : '';
      return `<span class="pt">${m.emoji} ${qty} ${m.label}${extra}</span>`;
    }).join('');

    const phone = (r.phone || '').replace(/\D/g, '');
    const wamsg = encodeURIComponent(`OlÃ¡ ${r.name.split(' ')[0]}! Vi seu pedido de abrigo para pets no SOS Juiz de Fora. Posso ajudar com o abrigo do seu animal!`);

    return `
    <div class="request-card">
      <div class="sc-head">
        <div>
          <div class="sc-name">${esc(r.name)}</div>
          <div class="sc-loc">ğŸ“ ${esc(r.bairro)}</div>
        </div>
        <span class="badge-request">ğŸ†˜ Precisa de abrigo</span>
      </div>
      <div class="pet-tags">${ptags}</div>
      ${r.notes ? `<div class="sc-notes">"${esc(r.notes)}"</div>` : ''}
      ${r.needed_until ? `<div class="sc-date">ğŸ“… Precisa atÃ© ${fmtDate(r.needed_until)}</div>` : ''}
      <a class="btn-wa" href="https://wa.me/55${phone}?text=${wamsg}" target="_blank" rel="noopener">
        ğŸ’¬ Oferecer ajuda pelo WhatsApp
      </a>
      <button class="btn-encerrar" onclick="toggleEncerrar('renc-${r.id}')">
        Marcar como resolvido
      </button>
      <div class="encerrar-form" id="renc-${r.id}">
        <p>âœ… Confirme seu WhatsApp para encerrar este pedido:</p>
        <input type="tel" id="renc-phone-${r.id}" placeholder="(32) 99999-9999">
        <button class="btn-confirmar-enc" onclick="encerrarRequest(${r.id}, 'renc-${r.id}')">
          Confirmar
        </button>
        <div class="enc-erro" id="renc-erro-${r.id}">NÃºmero incorreto. Tente novamente.</div>
      </div>
    </div>`;
  }).join('');
}

async function encerrarRequest(id, formId) {
  const input = document.getElementById('renc-phone-' + id);
  const erroEl = document.getElementById('renc-erro-' + id);
  erroEl.style.display = 'none';

  const digitado = input.value.replace(/\D/g, '');
  if (digitado.length < 10) {
    erroEl.textContent = 'Informe o WhatsApp cadastrado.';
    erroEl.style.display = 'block';
    return;
  }

  const { data } = await db.from('pet_requests').select('phone').eq('id', id).single();
  if (!data || data.phone.replace(/\D/g,'') !== digitado) {
    erroEl.textContent = 'NÃºmero incorreto. Tente novamente.';
    erroEl.style.display = 'block';
    return;
  }

  const btn = document.querySelector(`#${formId} .btn-confirmar-enc`);
  btn.textContent = 'Encerrando...';
  btn.disabled = true;

  const { error } = await db.from('pet_requests').delete().eq('id', id);
  if (error) {
    erroEl.textContent = 'Erro ao encerrar. Tente novamente.';
    erroEl.style.display = 'block';
    btn.textContent = 'Confirmar';
    btn.disabled = false;
    return;
  }
  renderRequests();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIND / FILTER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let activeFilter = 'all';

function setFilter(type, btn) {
  activeFilter = type;
  document.querySelectorAll('.f-chip').forEach(el => el.classList.remove('on'));
  btn.classList.add('on');
  renderShelters();
}

const PET_META = {
  dogs:     { emoji:'ğŸ¶', label:'CÃ£o/CÃ£es' },
  cats:     { emoji:'ğŸ±', label:'Gato/Gatos' },
  birds:    { emoji:'ğŸ¦', label:'PÃ¡ssaro/Aves' },
  rabbits:  { emoji:'ğŸ°', label:'Coelho/Coelhos' },
  reptiles: { emoji:'ğŸ¦', label:'RÃ©ptil/RÃ©pteis' },
  others:   { emoji:'ğŸ¹', label:'Outros' },
};
const SIZE_LBL = { small:'Pequeno porte', medium:'MÃ©dio porte', large:'Grande porte' };
const COND_LBL = { vaccinated:'ğŸ’‰ Vacinado', castrated:'âœ‚ï¸ Castrado', 'owner-present':'ğŸ‘¤ Tutor fica junto' };

async function renderShelters() {
  const list = document.getElementById('shelters-list');
  list.innerHTML = '<div class="empty"><div class="e-ico">â³</div>Carregando...</div>';

  const { data, error } = await db
    .from('pet_shelters')
    .select('*')
    .order('created_at', { ascending: false });

  if (error) {
    list.innerHTML = '<div class="empty">Erro ao carregar os abrigos. Tente novamente.</div>';
    return;
  }

  const q = document.getElementById('search-input').value.toLowerCase().trim();
  let shelters = data || [];

  if (activeFilter !== 'all') shelters = shelters.filter(s => s.pets && s.pets[activeFilter]);
  if (q) shelters = shelters.filter(s =>
    s.bairro.toLowerCase().includes(q) || s.name.toLowerCase().includes(q)
  );

  if (!shelters.length) {
    list.innerHTML = `
      <div class="empty">
        <div class="e-ico">ğŸ¾</div>
        <strong>Nenhum abrigo encontrado</strong>
        <div style="font-size:13px;margin-top:8px">Seja o primeiro a oferecer abrigo na sua regiÃ£o!</div>
      </div>`;
    return;
  }

  list.innerHTML = shelters.map(s => {
    const ptags = Object.entries(s.pets || {}).map(([t, qty]) => {
      const m = PET_META[t] || { emoji:'ğŸ¾', label: t };
      let extra = '';
      if (t === 'dogs' && s.dog_sizes?.length)
        extra = ` (${s.dog_sizes.map(x => SIZE_LBL[x]).join(', ')})`;
      if ((t === 'others' || t === 'reptiles') && s.other_type)
        extra = ` â€“ ${esc(s.other_type)}`;
      return `<span class="pt">${m.emoji} ${qty} vaga${qty > 1 ? 's' : ''} ${m.label}${extra}</span>`;
    }).join('');

    const reqStr = (s.conds || []).map(c => COND_LBL[c] || c).join(' Â· ');
    const phone  = (s.phone || '').replace(/\D/g, '');
    const wamsg  = encodeURIComponent(`OlÃ¡ ${s.name.split(' ')[0]}! Vi seu cadastro no SOS Juiz de Fora oferecendo abrigo para pets. Preciso de ajuda para meu animal. VocÃª ainda pode ajudar?`);

    return `
    <div class="shelter-card">
      <div class="sc-head">
        <div>
          <div class="sc-name">${esc(s.name)}</div>
          <div class="sc-loc">ğŸ“ ${esc(s.bairro)}${s.address_ref ? ' Â· ' + esc(s.address_ref) : ''}</div>
        </div>
        <span class="badge-avail">âœ… DisponÃ­vel</span>
      </div>
      <div class="pet-tags">${ptags}</div>
      ${reqStr ? `<div class="sc-reqs">Requisitos: ${reqStr}</div>` : ''}
      ${s.notes ? `<div class="sc-notes">"${esc(s.notes)}"</div>` : ''}
      ${s.available_from ? `<div class="sc-date">ğŸ“… A partir de ${fmtDate(s.available_from)}${s.available_until ? ' atÃ© ' + fmtDate(s.available_until) : ''}</div>` : ''}
      <a class="btn-wa" href="https://wa.me/55${phone}?text=${wamsg}" target="_blank" rel="noopener">
        ğŸ’¬ Entrar em contato pelo WhatsApp
      </a>
      <button class="btn-encerrar" onclick="toggleEncerrar('enc-${s.id}')">
        Encerrar meu abrigo
      </button>
      <div class="encerrar-form" id="enc-${s.id}">
        <p>âš ï¸ Confirme seu WhatsApp para encerrar este abrigo:</p>
        <input type="tel" id="enc-phone-${s.id}" placeholder="(32) 99999-9999">
        <button class="btn-confirmar-enc" onclick="encerrarAbrigo(${s.id}, 'enc-${s.id}')">
          Confirmar encerramento
        </button>
        <div class="enc-erro" id="enc-erro-${s.id}">NÃºmero incorreto. Tente novamente.</div>
      </div>
    </div>`;
  }).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function updateStats() {
  const { data } = await db.from('pet_shelters').select('pets');
  if (!data) return;
  let dogs = 0, cats = 0, other = 0;
  data.forEach(s => {
    if (!s.pets) return;
    dogs  += s.pets.dogs     || 0;
    cats  += s.pets.cats     || 0;
    other += (s.pets.birds   || 0) + (s.pets.rabbits  || 0)
           + (s.pets.reptiles|| 0) + (s.pets.others   || 0);
  });
  document.getElementById('sn-total').textContent = data.length;
  document.getElementById('sn-dogs').textContent  = dogs;
  document.getElementById('sn-cats').textContent  = cats;
  document.getElementById('sn-other').textContent = other;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ENCERRAR ABRIGO
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleEncerrar(formId) {
  const el = document.getElementById(formId);
  el.style.display = el.style.display === 'block' ? 'none' : 'block';
}

async function encerrarAbrigo(id, formId) {
  const input = document.getElementById('enc-phone-' + id);
  const erroEl = document.getElementById('enc-erro-' + id);
  erroEl.style.display = 'none';

  const digitado = input.value.replace(/\D/g, '');
  if (digitado.length < 10) {
    erroEl.textContent = 'Informe o WhatsApp cadastrado.';
    erroEl.style.display = 'block';
    return;
  }

  // Busca o registro para verificar o telefone
  const { data } = await db.from('pet_shelters').select('phone').eq('id', id).single();
  if (!data || data.phone.replace(/\D/g,'') !== digitado) {
    erroEl.textContent = 'NÃºmero incorreto. Tente novamente.';
    erroEl.style.display = 'block';
    return;
  }

  const btn = document.querySelector(`#${formId} .btn-confirmar-enc`);
  btn.textContent = 'Encerrando...';
  btn.disabled = true;

  const { error } = await db.from('pet_shelters').delete().eq('id', id);

  if (error) {
    erroEl.textContent = 'Erro ao encerrar. Tente novamente.';
    erroEl.style.display = 'block';
    btn.textContent = 'Confirmar encerramento';
    btn.disabled = false;
    return;
  }

  renderShelters();
  updateStats();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function esc(str) {
  const d = document.createElement('div');
  d.textContent = str || '';
  return d.innerHTML;
}

function fmtDate(s) {
  if (!s) return '';
  const [y, m, d] = s.split('-');
  return `${d}/${m}/${y}`;
}

function today() {
  return new Date().toISOString().split('T')[0];
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('f-from').value = today();
updateStats();
</script>

</body>
</html>
